<section
  data-aos="fade-up"
  class="bg-white p-8 rounded-xl shadow-md text-[#3e3020] font-body"
>
  <h2 class="text-2xl font-heading mb-6 text-center">
    How do I book for classes?
  </h2>
  <ol class="list-decimal list-inside space-y-3 text-lg max-w-3xl mx-auto">
    <li>Enrol for class</li>
    <li>
      Receive a confirmation mail from us with suggested dates from which you
      can choose
    </li>
    <li>
      Pay <strong>$40</strong> (International) or
      <strong>Rs.2500</strong> (Indian)
    </li>
    <li>Receive notifications (email, WhatsApp) before each class</li>
    <li>30 days class (1 hour each) for Morse reception (Audio)</li>
    <li>10 days MMD Signal exam practice for <strong>Rs.1500</strong></li>
    <li>
      Additional 10 days sending practice â€“
      <span class="text-green-700 font-semibold">Free</span>
    </li>
  </ol>
</section>
<section
  class="container flex flex-col items-center bg-[#f4f1ea] py-12 font-body text-[#3e3020] fade-up-init"
>
  <div class="w-full md:max-w-6xl">
    <div class="bg-white p-10 rounded-xl shadow-lg max-w-6xl mx-auto">
      <h2 class="text-3xl font-heading text-[#3e3020] text-center mb-8">
        Enrol For Class
      </h2>

      <!-- Stepper -->
      <ng-container *ngIf="userInfo?.token; else loginPrompt">
        <mat-horizontal-stepper linear #stepper>
          <!-- Step 1: Booking -->
          <mat-step [stepControl]="currentForm">
            <!-- Class Type Selection -->
            <div class="mb-6">
              <mat-form-field appearance="fill" class="w-full">
                <mat-label>Class Type</mat-label>
                <mat-select [(ngModel)]="selectedClassType">
                  <mat-option value="normal">Normal Class</mat-option>
                  <mat-option value="mmdSignal">MMD Signal Class</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <form [formGroup]="currentForm">
              <ng-template matStepLabel>Booking</ng-template>

              <!-- Normal Class -->
              <div
                *ngIf="selectedClassType === 'normal'"
                class="grid grid-cols-1 md:grid-cols-2 gap-6"
              >
                <div>
                  <label class="block mb-1 font-semibold">Name</label>
                  <input
                    type="text"
                    formControlName="name"
                    class="w-full border border-[#c3b27a] rounded px-4 py-2 bg-[#fdfaf4]"
                  />
                </div>
                <div>
                  <label class="block mb-1 font-semibold">Email ID</label>
                  <input
                    type="email"
                    formControlName="email"
                    class="w-full border border-[#c3b27a] rounded px-4 py-2 bg-[#fdfaf4]"
                  />
                </div>
                <div>
                  <label class="block mb-1 font-semibold">Country</label>
                  <mat-form-field appearance="fill" class="w-full">
                    <mat-label>Select Country</mat-label>
                    <mat-select formControlName="country">
                      <mat-option
                        *ngFor="let country of country"
                        [value]="country.name"
                        >{{ country.name }}</mat-option
                      >
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="md:col-span-2">
                  <label class="block mb-1 font-semibold"
                    >Phone Number (WhatsApp)</label
                  >
                  <div
                    class="flex items-stretch border border-[#c3b27a] rounded bg-[#fdfaf4] overflow-hidden"
                  >
                    <select
                      class="px-3 py-2 bg-[#e6dcc5] border-r border-[#c3b27a] focus:outline-none"
                    >
                      <option
                        *ngFor="let country of countries"
                        [value]="country.dialCode"
                      >
                        {{ country.dialCode }}
                      </option>
                    </select>
                    <input
                      type="tel"
                      formControlName="phone"
                      placeholder="Enter phone number"
                      class="flex-1 px-4 py-2 bg-transparent focus:outline-none text-[#3e3020]"
                    />
                  </div>
                </div>
                <div class="md:col-span-2 text-sm italic text-gray-600 mt-4">
                  <p>* available dates will be informed by mail</p>
                </div>
              </div>

              <!-- MMD Signal Class -->
              <div
                *ngIf="selectedClassType === 'mmdSignal'"
                class="grid grid-cols-1 md:grid-cols-2 gap-6"
              >
                <div>
                  <label class="block mb-1 font-semibold">Name</label>
                  <input
                    type="text"
                    formControlName="name"
                    class="w-full border border-[#c3b27a] rounded px-4 py-2 bg-[#fdfaf4]"
                  />
                </div>
                <div>
                  <label class="block mb-1 font-semibold">Email ID</label>
                  <input
                    type="email"
                    formControlName="email"
                    class="w-full border border-[#c3b27a] rounded px-4 py-2 bg-[#fdfaf4]"
                  />
                </div>
                <div>
                  <label class="block mb-1 font-semibold">Country</label>
                  <mat-form-field appearance="fill" class="w-full">
                    <mat-label>Select Country</mat-label>
                    <mat-select formControlName="country">
                      <mat-option
                        *ngFor="let country of country"
                        [value]="country.name"
                        >{{ country.name }}</mat-option
                      >
                    </mat-select>
                  </mat-form-field>
                </div>
                <div>
                  <label class="block mb-1 font-semibold"
                    >Phone Number (WhatsApp)</label
                  >
                  <div
                    class="flex items-stretch border border-[#c3b27a] rounded bg-[#fdfaf4] overflow-hidden"
                  >
                    <select
                      class="px-3 py-2 bg-[#e6dcc5] border-r border-[#c3b27a] focus:outline-none"
                    >
                      <option
                        *ngFor="let country of countries"
                        [value]="country.dialCode"
                      >
                        {{ country.dialCode }}
                      </option>
                    </select>
                    <input
                      type="tel"
                      formControlName="phone"
                      placeholder="Enter phone number"
                      class="flex-1 px-4 py-2 bg-transparent focus:outline-none text-[#3e3020]"
                    />
                  </div>
                </div>
                <div>
                  <label class="block mb-1 font-semibold">MMD Centre</label>
                  <mat-form-field appearance="fill" class="w-full">
                    <mat-label>Select Centre</mat-label>
                    <mat-select formControlName="mmdCenterName">
                      <mat-option
                        *ngFor="let centre of mmdCentres"
                        [value]="centre.centerName"
                        >{{ centre.centerName }}</mat-option
                      >
                    </mat-select>
                  </mat-form-field>
                </div>
                <div>
                  <label class="block mb-1 font-semibold">MMD Exam Date</label>
                  <mat-form-field appearance="fill" class="w-full">
                    <mat-label>Choose Date</mat-label>
                    <input
                      matInput
                      [matDatepicker]="mmdPicker"
                      formControlName="examDate"
                    />
                    <mat-datepicker-toggle
                      matSuffix
                      [for]="mmdPicker"
                    ></mat-datepicker-toggle>
                    <mat-datepicker #mmdPicker></mat-datepicker>
                  </mat-form-field>
                </div>
                <div class="md:col-span-2 text-sm italic text-gray-600 mt-2">
                  (10 Classes will be provided online prior to exam date. Dates
                  and time will be intimated through email/whatsapp)
                </div>
              </div>

              <div class="flex justify-end mt-6">
                <button
                  mat-raised-button
                  class="bg-[#c3b27a] hover:bg-[#b39f66] text-white font-heading px-6 py-2 rounded"
                  matStepperNext
                  type="button"
                  [disabled]="!isCurrentStepValid()"
                >
                  Next: Payment
                </button>
              </div>
            </form>
          </mat-step>

          <!-- Step 2: Payment -->
          <mat-step>
            <ng-template matStepLabel>Payment</ng-template>
            <div class="text-center py-6 px-3 sm:px-6">
              <!-- Fee Info -->
              <div
                class="bg-yellow-50 border-l-4 border-yellow-700 p-4 sm:p-6 rounded text-left max-w-xl mx-auto mb-6"
              >
                <p class="text-base sm:text-lg font-heading">
                  Class Fee:
                  <span
                    *ngIf="selectedClassType === 'normal'"
                    class="text-lg sm:text-xl font-bold text-yellow-900"
                  >
                    {{
                      normalForm.get("country")?.value === "India"
                        ? (2500 | currency : "INR")
                        : (40 | currency : "USD")
                    }}
                  </span>

                  <span
                    *ngIf="selectedClassType === 'mmdSignal'"
                    class="text-lg sm:text-xl font-bold text-yellow-900"
                  >
                    {{ 1500 | currency : "INR" }}
                  </span>
                </p>

                <p class="text-sm text-gray-700 mt-1">
                  Please make the payment via Bank or GPay.
                </p>
              </div>

              <!-- Bank Details -->
              <div
                class="bg-white border border-yellow-900 rounded-lg shadow p-4 sm:p-6 max-w-xl mx-auto mb-6 text-left text-sm sm:text-base"
              >
                <h3 class="text-base sm:text-lg font-heading mb-2">
                  Bank Transfer Details
                </h3>
                <ul class="text-gray-800 leading-relaxed">
                  <li><strong>Bank Name:</strong> State Bank of India</li>
                  <li><strong>Account Name:</strong> Morse Monk Solutions</li>
                  <li><strong>Account Number:</strong> 123456789012</li>
                  <li><strong>IFSC Code:</strong> SBIN0001234</li>
                  <li><strong>Branch:</strong> Kochi Main</li>
                </ul>
              </div>

              <!-- GPay Option -->
              <div
                class="bg-yellow-100 border border-yellow-700 rounded-lg p-4 max-w-xl mx-auto text-left text-sm sm:text-base mb-6"
              >
                <h3
                  class="text-base sm:text-lg font-heading text-yellow-900 mb-1"
                >
                  GPay (Preferred)
                </h3>
                <p class="text-sm text-gray-800">Send payment to:</p>
                <div
                  class="bg-white mt-2 p-3 rounded-lg text-center border border-yellow-800"
                >
                  <span
                    class="text-lg font-bold text-[#3e3020] select-all block"
                    >+91 9497445288</span
                  >
                  <p class="text-xs text-gray-600 mt-1">
                    (Tap and hold to copy)
                  </p>
                </div>
              </div>

              <div
                class="max-w-xl mx-auto p-4 sm:p-6 bg-white rounded-lg shadow-md mt-4"
              >
                <form [formGroup]="normalFormFeePaid">
                  <div>
                    <!-- Fee Paid Date -->
                    <label class="block mb-1 font-semibold"
                      >Fee paid date</label
                    >
                    <mat-form-field appearance="fill" class="w-full">
                      <mat-label>Choose Date</mat-label>
                      <input
                        matInput
                        [matDatepicker]="feeDate"
                        formControlName="paidDate"
                      />
                      <mat-datepicker-toggle
                        matSuffix
                        [for]="feeDate"
                      ></mat-datepicker-toggle>
                      <mat-datepicker #feeDate></mat-datepicker>
                    </mat-form-field>
                  </div>

                  <!-- Payment Method Radio Group -->
                  <div class="mt-4">
                    <label class="block mb-1 font-semibold"
                      >Payment Method</label
                    >
                    <mat-radio-group
                      formControlName="paymentMethod"
                      class="flex gap-2"
                    >
                      <mat-radio-button value="gpay">GPay</mat-radio-button>
                      <mat-radio-button value="bankTransfer"
                        >Bank Transfer</mat-radio-button
                      >
                    </mat-radio-group>
                  </div>
                </form>
              </div>

              <!-- Submit Button -->
              <button
                *ngIf="!isLoading"
                mat-raised-button
                [disabled]="!normalFormFeePaid.valid"
                class="bg-[rgb(94,75,43)] hover:bg-[#997950] text-white font-heading px-6 py-2 rounded mt-6 w-full sm:w-auto"
                (click)="onSubmit($event)"
              >
                Complete Registration
              </button>
              <button
                *ngIf="isLoading"
                type="button"
                class="bg-[rgb(94,75,43)] hover:bg-[#997950] text-white font-heading px-6 py-2 rounded mt-6 w-full sm:w-auto"
                disabled
              >
                <svg
                  class="animate-spin h-5 w-5 mr-2 inline"
                  viewBox="0 0 24 24"
                >
                  <circle
                    class="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    stroke-width="4"
                  ></circle>
                  <path
                    class="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8v4l3-3-3-3v4a8 8 0 100 16v-4l-3 3 3 3v-4a8 8 0 01-8-8z"
                  />
                </svg>
                Loading...
              </button>
            </div>
          </mat-step>
        </mat-horizontal-stepper>
      </ng-container>

      <ng-template #loginPrompt>
        <div class="text-center py-12">
          <p class="text-lg font-semibold mb-4 text-[#3e3020]">
            Please log in to book a class.
          </p>
          <button
            (click)="navigateToLogin()"
            class="py-2 px-4 text-base font-heading rounded-lg border border-yellow-800 bg-[#5e4b2b] text-white hover:bg-[#997950] transition-all"
          >
            Login
          </button>
        </div>
      </ng-template>
      <p class="mt-6 text-center text-sm text-gray-600 italic">
        * Login required to register
      </p>
    </div>
  </div>
</section>
<app-payment-status
  [paymentMethod]="'class'"
  *ngIf="isPaymentDone"
></app-payment-status>
